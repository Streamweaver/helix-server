from django.db import migrations
from django.conf import settings

from apps.contrib.migrate_commands import merge_events as update_figures_and_merge_events


# https://github.com/idmc-labs/helix2.0-meta/issues/1041
EVENT_ID_MAP = {
    "22166": [16137, 16138, 16175, 16200],
    "22167": [14032, 14033],
    "22168": [13578, 13623, 13668, 13669, 13672, 13783],
    "22169": [13482, 13512, 13529, 13530, 13545],
    "22170": [17937, 17982, 18023, 18042, 18049],
    "22171": [13259, 13263, 13277, 13293],
    "22172": [17343, 17345, 17346, 17355],
    "22173": [18041, 18093, 18148],
    "22174": [12848, 14001],
    "22175": [17478, 17489, 17585],
    "22176": [13372, 13374, 13375, 13376, 13392],
    "22177": [13465, 13470],
    "22178": [13962, 13964, 13970, 13978, 13983, 13984, 14030, 15047],
    "22179": [13585, 13678],
    "22180": [15295, 15482],
    "22181": [18119, 18123, 18160, 18288],
    "22182": [13935, 13936],
    "22183": [16615, 16702],
    "22184": [13489, 13498],
    "22185": [17583, 17584, 17718, 17770],
    "22186": [15085, 15095, 15378, 15591, 15616, 15617],
    "22187": [11752, 13918, 13925, 13926],
    "22188": [11731, 13915],
    "22189": [11738, 13953],
    "22190": [13960, 13997],
    "22191": [16250, 16307, 16396],
    "22192": [13863, 13878, 13900, 14018],
    "22193": [19065, 19180],
    "22194": [14699, 14816],
    "22195": [18488, 18540, 18605, 18630],
    "22198": [15550, 15694],
    "22200": [18859, 18861],
    "22204": [18977, 19040],
    "22205": [18830, 18862, 18904, 18906],
    "22206": [18818, 18827, 18829],
    "22207": [19062, 19079, 19192, 19195, 19196, 19255, 19383],
    "22208": [19656, 19659],
    "22210": [17886, 17890],
    "22212": [17957, 18216],
}


def merge_events(*_):
    if settings.TESTING:
        return
    update_figures_and_merge_events(EVENT_ID_MAP)


class Migration(migrations.Migration):

    dependencies = [
        ('event', 'change_violence_types_and_sub_types'),
    ]

    operations = [
        migrations.RunPython(merge_events, reverse_code=migrations.RunPython.noop),
    ]
